import ConfigItem from "../../Config/ConfigItem.js";
import DrawWithTemporaryImageAndAnimationActionButton from "./DrawWithTemporaryImageAndAnimationActionButton.js";
export default class BungeePencilButton extends DrawWithTemporaryImageAndAnimationActionButton {
    constructor() {
        super(...arguments);
        this.BASE_ELASTICITY = 0.897;
        this.lineLength = 0;
        this.xVel = 0;
        this.yVel = 0;
        this.striped = false;
        this.lastDrawnBallX = null;
        this.lastDrawnBallY = null;
    }
    initContextProperties() {
        let lineLength = this.configContainer.getValueAsNumber(ConfigItem.STRIPE_GAP_LENGTH_PROPERTY);
        let gapLength = this.configContainer.getValueAsNumber(ConfigItem.STRIPE_GAP_LENGTH_PROPERTY);
        this.striped = this.configContainer.getValueAsBoolean(ConfigItem.STRIPED_LINE_PROPERTY);
        this.target.ctx.lineWidth = this.configContainer.getValueAsNumber(ConfigItem.LINE_WIDTH_PROPERTY);
        this.target.ctx.lineCap = this.striped ? 'butt' : 'round';
        this.target.ctx.setLineDash(this.striped ? [lineLength, gapLength] : []);
        this.target.ctx.globalAlpha = this.configContainer.getValueAsNumber(ConfigItem.OPACITY_PROPERTY);
        this.target.ctx.fillStyle = this.configContainer.getValueByProperty(ConfigItem.COLOR_PROPERTY);
        this.target.ctx.strokeStyle = this.configContainer.getValueByProperty(ConfigItem.COLOR_PROPERTY);
    }
    additionalOnMouseUp() {
        this.lastDrawnBallX = null;
        this.lastDrawnBallY = null;
        this.ballX = null;
        this.ballY = null;
    }
    drawTemporaryTo(xEnd, yEnd) {
        this.adjustParams(xEnd, yEnd);
        this.target.ctx.beginPath();
        this.target.ctx.ellipse(this.ballX, this.ballY, this.target.ctx.lineWidth / 2, this.target.ctx.lineWidth / 2, 0, 0, 2 * Math.PI);
        this.target.ctx.fill();
        this.target.ctx.closePath();
    }
    drawTo(xEnd, yEnd) {
        this.adjustParams(xEnd, yEnd);
        this.target.ctx.beginPath();
        this.target.ctx.moveTo(this.lastDrawnBallX || this.ballX, this.lastDrawnBallY || this.ballY);
        this.target.ctx.lineTo(this.ballX, this.ballY);
        this.target.ctx.stroke();
        this.target.ctx.closePath();
        this.lastMouseDownX = xEnd;
        this.lastMouseDownY = yEnd;
        this.lastDrawnBallX = this.ballX;
        this.lastDrawnBallY = this.ballY;
    }
    adjustParams(xEnd, yEnd) {
        this.initBallPositionIfEmpty(xEnd, yEnd);
        this.adjustVelocity(xEnd, yEnd);
        this.adjustBallPosition();
    }
    initBallPositionIfEmpty(xEnd, yEnd) {
        this.ballX = this.ballX || xEnd;
        this.ballY = this.ballY || yEnd;
    }
    adjustVelocity(xEnd, yEnd) {
        let elasticity = this.configContainer.getValueAsNumber(ConfigItem.GUM_ELASTICITY_PROPERTY);
        this.xVel = (this.xVel + (xEnd - this.lastMouseDownX) * 0.01 - (this.ballX - xEnd) * 0.01) * (this.BASE_ELASTICITY + elasticity / 10);
        this.yVel = (this.yVel + (yEnd - this.lastMouseDownY) * 0.01 - (this.ballY - yEnd) * 0.01) * (this.BASE_ELASTICITY + elasticity / 10);
    }
    adjustBallPosition() {
        this.ballX += this.xVel;
        this.ballY += this.yVel;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnVuZ2VlUGVuY2lsQnV0dG9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL0VsZW1lbnQvQnV0dG9uL0J1bmdlZVBlbmNpbEJ1dHRvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLFVBQVUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRCxPQUFPLDhDQUE4QyxNQUFNLHFEQUFxRCxDQUFDO0FBRWpILE1BQU0sQ0FBQyxPQUFPLE9BQU8sa0JBQW1CLFNBQVEsOENBQThDO0lBQTlGOztRQUV1QixvQkFBZSxHQUFHLEtBQUssQ0FBQTtRQUNoQyxlQUFVLEdBQVcsQ0FBQyxDQUFBO1FBQ3RCLFNBQUksR0FBVyxDQUFDLENBQUE7UUFDaEIsU0FBSSxHQUFXLENBQUMsQ0FBQTtRQUdoQixZQUFPLEdBQVksS0FBSyxDQUFBO1FBQ3hCLG1CQUFjLEdBQWdCLElBQUksQ0FBQTtRQUNsQyxtQkFBYyxHQUFnQixJQUFJLENBQUE7SUFrRmhELENBQUM7SUFoRmEscUJBQXFCO1FBRTNCLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLDBCQUEwQixDQUFDLENBQUE7UUFDN0YsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsMEJBQTBCLENBQUMsQ0FBQTtRQUM1RixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDLHFCQUFxQixDQUFDLENBQUE7UUFDdkYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLG1CQUFtQixDQUFDLENBQUE7UUFDakcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FB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